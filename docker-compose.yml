version: "3.8"

services:
  vsftpd_1:
    build: ./dockerfiles/dockerfile-c1
    # image: lhauspie/vsftpd-alpine:latest
    #สั่งรันหลัง build image เสร็จ
    # entrypoint: ["sh", "-c", "apk update && apk add --no-cache lftp && apk add busybox-extras && apk add curl"] 
    container_name: vsftpd_1
    restart: always
    ports:
      - "2222:21"
      - "21100-21110:21100-21110"
    environment:
      FTP_USER: "user1"
      FTP_PASS: "user1"
      PASV_ADDRESS: "10.1.194.44"
      PASV_MIN_PORT: "21100"
      PASV_MAX_PORT: "21110"
    volumes:
      - ./DATA/container-1:/home/vsftpd/user1/
    networks:
      - vlan-public
      - vlan-private   # ให้คุยกับ vsftpd_2 ได้

  vsftpd_2:
    build: ./dockerfiles/dockerfile-c2
    container_name: vsftpd_2
    restart: always
    ports:
      - "2223:21"
      - "22100-22110:22100-22110"
    environment:
      FTP_USER: "user2"
      FTP_PASS: "user2"
      PASV_ADDRESS: "10.1.194.44"
      PASV_MIN_PORT: "22100"
      PASV_MAX_PORT: "22110"
    volumes:
      - ./DATA/container-2:/home/vsftpd/user2/
    networks:
      - vlan-private  # คุยกับ vsftpd_1 ได้เท่านั้น

  vsftpd_3:
    build: ./dockerfiles/dockerfile-c3
    container_name: vsftpd_3
    restart: always
    ports:
      - "2224:21"
      - "23100-23110:23100-23110"
    environment:
      FTP_USER: "user3"
      FTP_PASS: "user3"
      PASV_ADDRESS: "10.1.194.44"
      PASV_MIN_PORT: "23100"
      PASV_MAX_PORT: "23110"
    volumes:
      - ./DATA/container-3:/home/vsftpd/user3/
    networks:
      - vlan-isolated

networks:
  vlan-public:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.10.0/24
          gateway: 192.168.10.1

  vlan-private:
    driver: bridge
    internal: true
    ipam:
      config:
        - subnet: 192.168.20.0/24
          gateway: 192.168.20.1

  vlan-isolated:
    driver: bridge
    internal: true
    ipam:
      config:
        - subnet: 192.168.30.0/24
          gateway: 192.168.30.1